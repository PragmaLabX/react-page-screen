"use strict";var e=require("react");function n(){return n=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},n.apply(null,arguments)}const t=({nextScreen:t,backScreen:a,preloadScreen:r,deleteScreens:c,Screen:s,BackButtonComponent:o,level:i,basePageClassName:d})=>{const{showBackButton:l=!1,effect:f="no-effect",effectStep:p="",onBackScreen:u=()=>{},className:m="",screenName:S,screenId:x,Component:b,initiatorScreenEffectName:O,props:g={}}=s,k=(({initiatorScreenEffectName:n="no-effect",nextScreenEffectName:t="no-effect",nextScreenEffectStep:a}={})=>{const r={"data-next-screen-effect-name":t,"data-initiator-screen-effect-name":n},[c,s]=e.useState(a);return e.useEffect((()=>{s("activated"==a?"executed":a)}),[a]),{...r,"data-next-screen-effect-step":c}})({initiatorScreenEffectName:O,nextScreenEffectName:f,nextScreenEffectStep:p}),N=()=>{a({screenId:x})};return e.createElement("div",n({className:`${d} ${m}`,"data-next-page-level":i,"data-next-page-name":S,"data-screen-id":x},k),e.createElement(b,n({nextScreen:({nextScreenOptions:e,currentScreenOptions:n,preloadedScreenId:a}={nextScreenOptions:{},currentScreenOptions:{},preloadedScreenId:null})=>{t({nextScreenOptions:{...e,preloaded:!1,preloadScreens:[]},initiatorScreenOptions:{screenId:x,...n||{}},preloadedScreenId:a})},backScreen:N,onBackScreen:u,deleteScreens:({screenNames:e,duration:n}={screenNames:[],duration:0})=>{c({screenNames:e,duration:n})},preloadScreen:({nextScreenOptions:n,currentScreenOptions:t})=>(({data:n,preloadScreenOriginal:t}={})=>{const[a,r]=e.useState(n),[c,s]=e.useState({updateProps:()=>{console.warn("updateProps is not initialized yet.")}});return e.useEffect((()=>{if(a){const e=t(n);s(e)}r(null)}),[]),c})({data:{nextScreenOptions:{...n,preloaded:!0,preloadScreens:[]},initiatorScreenOptions:{screenId:x,...t||{}}},preloadScreenOriginal:r})},g)),l&&e.createElement(o,{basePageClassName:d,onClick:()=>{u(),N()}}))},a=({durationOptions:n,basePageClassName:t})=>{const a=e.useRef(!1);e.useEffect((()=>{a.current||((({durationOptions:e,basePageClassName:n})=>{const t=n=>e[n]/1e3,a=document.createElement("style");a.innerHTML=`\n      \n        .${n} {\n            height: 100%;\n            width: 100%;\n            /*position: fixed;*/\n            position: absolute;\n            left:0;\n            right: auto;\n            transition: \n                left ${t("slide")}s,\n                opacity ${t("fade")}s,\n                transform ${t("blur")}s ease-out;\n        }\n          \n        .${n}[data-next-screen-effect-step=expected]{\n            right: 100%;\n            left: auto;\n        }\n        \n        .${n}[data-next-screen-effect-name=slide]{\n            left: 100%;\n        }\n        \n        .${n}[data-next-screen-effect-name=slide][data-next-screen-effect-step=executed]{\n            left: 0;\n        }\n        \n        /* double check that fix, reproducing when screen2 is slide and screen3 is slide, result: screen 2 left-20 is not working */\n        .${n}[data-next-screen-effect-name=slide][data-next-screen-effect-step=executed][data-initiator-screen-effect-name=slide],\n        .${n}[data-initiator-screen-effect-name=slide]{\n            left: -20%;\n        }\n        \n        .${n}[data-next-screen-effect-name=fade]{\n            opacity: 0;\n        }\n        \n        .${n}[data-next-screen-effect-name=fade][data-next-screen-effect-step=executed]{\n            opacity: 1;\n        }\n        \n        .${n}[data-initiator-screen-effect-name=blur]{\n            filter: blur(10px);\n            transform: scale(1.1);\n        }\n        .${n}-button-default{\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            background: #00000045;\n            border-radius: 25px;\n            width: 50px;\n            height: 50px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .${n}-button-default-icon {\n            width: 15px;\n            height: 15px;\n            border: solid #ffffff;\n            border-width: 0 2px 2px 0;\n            display: inline-block;\n            transform: rotate(135deg);\n            margin-left: 5px;\n        }\n        \n        ${Array.from({length:10},((e,t)=>`\n        .${n}[data-next-page-level="${t+1}"]{\n            z-index: ${100*(t+1)+1}\n        }\n        .${n}[data-next-page-level="${t+1}"] .${n}-back-button{\n            z-index: ${100*(t+1)+100-1}\n        }\n        `)).join("")}\n    `,document.head.appendChild(a)})({durationOptions:n,basePageClassName:t}),a.current=!0)}),[])},r=({onClick:n,basePageClassName:t})=>e.createElement("div",{className:`${t}-back-button ${t}-back-button-default`,onClick:n},e.createElement("div",{className:"back-button-default-icon"})),c=({BackButtonComponentCustom:n})=>e.useMemo((()=>n?(({BackButtonComponentCustom:n})=>({onClick:t,basePageClassName:a})=>e.createElement("div",{className:`${a}-back-button ${a}-back-button-custom`,onClick:t},e.createElement(n,null)))({BackButtonComponentCustom:n}):r),[n]),s=()=>Date.now().toString(36)+Math.random().toString(36).substring(2,8),o=({initiatorScreen:e,effectName:n})=>e?{[e.screenId]:{...e,initiatorScreenEffectName:n}}:{};module.exports=({initScreenOptions:n,durationOptions:r,BackButtonComponent:i,basePageClassName:d="next-page"})=>{const l=c({BackButtonComponentCustom:i}),{nextScreen:f,deleteScreens:p,backScreen:u,preloadScreen:m,screens:S,durationOptions:x}=(({durationCustomOptions:n={}})=>{const[t,a]=e.useState({}),[r]=e.useState({"no-effect":0,fade:n.fade||300,slide:n.slide||300,blur:n.blur||150}),c=({screenNames:e=[],screenIds:n=[],duration:t=0,preloadedScreenToReset:r})=>{setTimeout((()=>{a((t=>({...Object.fromEntries(Object.entries(t).filter((([t,a])=>!e.includes(a.screenName)&&!n.includes(a.screenId)))),...r?{[r.screenId]:{...r,effectStep:"expected"}}:{}})))}),t)};return{nextScreen:({nextScreenOptions:e,initiatorScreenOptions:n,preloadedScreenId:r})=>{const c=r?t[r]:e,i=r||`${c?.screenName||""}_${s()}`,d=r?c.initiatorScreenOptions:n,l=o({initiatorScreen:t[d?.screenId],effectName:d?.onNext?.effect||c?.effect||"no-effect"});a((e=>({...e,...l,[i]:{...c,screenId:i,initiatorScreenOptions:d,effectStep:"activated"}})))},deleteScreens:c,backScreen:({screenId:e})=>{const n=t[e],s=t[n?.initiatorScreenOptions.screenId],i={[e]:{...n,effectStep:"exited"}},d=o({initiatorScreen:s,effectName:"no-effect"});a((e=>({...e,...d,...i}))),c({screenIds:[e,...n.preloadScreens],duration:r[n.effect],preloadedScreenToReset:n.preloaded?n:null})},preloadScreen:({nextScreenOptions:e,initiatorScreenOptions:n})=>{const c=`${e?.screenName||""}_${s()}`,o=n.screenId,i=t[o];return setTimeout((()=>{a((t=>({...t,[o]:{...i,preloadScreens:[...t[o].preloadScreens,c]},[c]:{...e,screenId:c,initiatorScreenOptions:n,effectStep:"expected"}})))}),r[i.effect]),{preloadedScreenId:c,updateProps:e=>{a((n=>({...n,[c]:{...n[c],props:{...n[c].props,...e}}})))}}},screens:t,durationOptions:r}})({durationCustomOptions:r}),[b,O]=e.useState(!1);e.useEffect((()=>{b&&f({nextScreenOptions:{...n,showBackButton:!1}}),O(!0)}),[b]),a({durationOptions:x,basePageClassName:d});const g=Object.keys(S).map(((n,a)=>e.createElement(t,{key:n,level:a,nextScreen:f,deleteScreens:p,backScreen:u,preloadScreen:m,Screen:S[n],BackButtonComponent:l,BackButtonComponent:()=>e.createElement(e.Fragment,null,"BackB"),basePageClassName:d})));return g};

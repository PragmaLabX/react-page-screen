import e,{useState as n,useEffect as t,useRef as a,useMemo as r}from"react";function c(){return c=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)({}).hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},c.apply(null,arguments)}const o=({nextScreen:a,backScreen:r,preloadScreen:o,deleteScreens:s,Screen:i,BackButtonComponent:d,level:l,basePageClassName:f})=>{const{showBackButton:p=!1,effect:u="no-effect",effectStep:m="",onBackScreen:S=()=>{},className:x="",screenName:b,screenId:O,Component:g,initiatorScreenEffectName:k,props:N={}}=i,$=(({initiatorScreenEffectName:e="no-effect",nextScreenEffectName:a="no-effect",nextScreenEffectStep:r}={})=>{const c={"data-next-screen-effect-name":a,"data-initiator-screen-effect-name":e},[o,s]=n(r);return t((()=>{s("activated"==r?"executed":r)}),[r]),{...c,"data-next-screen-effect-step":o}})({initiatorScreenEffectName:k,nextScreenEffectName:u,nextScreenEffectStep:m}),C=()=>{r({screenId:O})};return e.createElement("div",c({className:`${f} ${x}`,"data-next-page-level":l,"data-next-page-name":b,"data-screen-id":O},$),e.createElement(g,c({nextScreen:({nextScreenOptions:e,currentScreenOptions:n,preloadedScreenId:t}={nextScreenOptions:{},currentScreenOptions:{},preloadedScreenId:null})=>{a({nextScreenOptions:{...e,preloaded:!1,preloadScreens:[]},initiatorScreenOptions:{screenId:O,...n||{}},preloadedScreenId:t})},backScreen:C,onBackScreen:S,deleteScreens:({screenNames:e,duration:n}={screenNames:[],duration:0})=>{s({screenNames:e,duration:n})},preloadScreen:({nextScreenOptions:e,currentScreenOptions:a})=>(({data:e,preloadScreenOriginal:a}={})=>{const[r,c]=n(e),[o,s]=n({updateProps:()=>{console.warn("updateProps is not initialized yet.")}});return t((()=>{if(r){const n=a(e);s(n)}c(null)}),[]),o})({data:{nextScreenOptions:{...e,preloaded:!0,preloadScreens:[]},initiatorScreenOptions:{screenId:O,...a||{}}},preloadScreenOriginal:o})},N)),p&&e.createElement(d,{basePageClassName:f,onClick:()=>{S(),C()}}))},s=({durationOptions:e,basePageClassName:n})=>{const r=a(!1);t((()=>{r.current||((({durationOptions:e,basePageClassName:n})=>{const t=n=>e[n]/1e3,a=document.createElement("style");a.innerHTML=`\n      \n        .${n} {\n            height: 100%;\n            width: 100%;\n            /*position: fixed;*/\n            position: absolute;\n            left:0;\n            right: auto;\n            transition: \n                left ${t("slide")}s,\n                opacity ${t("fade")}s,\n                transform ${t("blur")}s ease-out;\n        }\n          \n        .${n}[data-next-screen-effect-step=expected]{\n            right: 100%;\n            left: auto;\n        }\n        \n        .${n}[data-next-screen-effect-name=slide]{\n            left: 100%;\n        }\n        \n        .${n}[data-next-screen-effect-name=slide][data-next-screen-effect-step=executed]{\n            left: 0;\n        }\n        \n        /* double check that fix, reproducing when screen2 is slide and screen3 is slide, result: screen 2 left-20 is not working */\n        .${n}[data-next-screen-effect-name=slide][data-next-screen-effect-step=executed][data-initiator-screen-effect-name=slide],\n        .${n}[data-initiator-screen-effect-name=slide]{\n            left: -20%;\n        }\n        \n        .${n}[data-next-screen-effect-name=fade]{\n            opacity: 0;\n        }\n        \n        .${n}[data-next-screen-effect-name=fade][data-next-screen-effect-step=executed]{\n            opacity: 1;\n        }\n        \n        .${n}[data-initiator-screen-effect-name=blur]{\n            filter: blur(10px);\n            transform: scale(1.1);\n        }\n        .${n}-button-default{\n            position: absolute;\n            top: 10px;\n            left: 10px;\n            background: #00000045;\n            border-radius: 25px;\n            width: 50px;\n            height: 50px;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }\n        .${n}-button-default-icon {\n            width: 15px;\n            height: 15px;\n            border: solid #ffffff;\n            border-width: 0 2px 2px 0;\n            display: inline-block;\n            transform: rotate(135deg);\n            margin-left: 5px;\n        }\n        \n        ${Array.from({length:10},((e,t)=>`\n        .${n}[data-next-page-level="${t+1}"]{\n            z-index: ${100*(t+1)+1}\n        }\n        .${n}[data-next-page-level="${t+1}"] .${n}-back-button{\n            z-index: ${100*(t+1)+100-1}\n        }\n        `)).join("")}\n    `,document.head.appendChild(a)})({durationOptions:e,basePageClassName:n}),r.current=!0)}),[])},i=({onClick:n,basePageClassName:t})=>e.createElement("div",{className:`${t}-back-button ${t}-back-button-default`,onClick:n},e.createElement("div",{className:"back-button-default-icon"})),d=({BackButtonComponentCustom:n})=>r((()=>n?(({BackButtonComponentCustom:n})=>({onClick:t,basePageClassName:a})=>e.createElement("div",{className:`${a}-back-button ${a}-back-button-custom`,onClick:t},e.createElement(n,null)))({BackButtonComponentCustom:n}):i),[n]),l=()=>Date.now().toString(36)+Math.random().toString(36).substring(2,8),f=({initiatorScreen:e,effectName:n})=>e?{[e.screenId]:{...e,initiatorScreenEffectName:n}}:{};var p=({initScreenOptions:a,durationOptions:r,BackButtonComponent:c,basePageClassName:i="next-page"})=>{const p=d({BackButtonComponentCustom:c}),{nextScreen:u,deleteScreens:m,backScreen:S,preloadScreen:x,screens:b,durationOptions:O}=(({durationCustomOptions:e={}})=>{const[t,a]=n({}),[r]=n({"no-effect":0,fade:e.fade||300,slide:e.slide||300,blur:e.blur||150}),c=({screenNames:e=[],screenIds:n=[],duration:t=0,preloadedScreenToReset:r})=>{setTimeout((()=>{a((t=>({...Object.fromEntries(Object.entries(t).filter((([t,a])=>!e.includes(a.screenName)&&!n.includes(a.screenId)))),...r?{[r.screenId]:{...r,effectStep:"expected"}}:{}})))}),t)};return{nextScreen:({nextScreenOptions:e,initiatorScreenOptions:n,preloadedScreenId:r})=>{const c=r?t[r]:e,o=r||`${c?.screenName||""}_${l()}`,s=r?c.initiatorScreenOptions:n,i=f({initiatorScreen:t[s?.screenId],effectName:s?.onNext?.effect||c?.effect||"no-effect"});a((e=>({...e,...i,[o]:{...c,screenId:o,initiatorScreenOptions:s,effectStep:"activated"}})))},deleteScreens:c,backScreen:({screenId:e})=>{const n=t[e],o=t[n?.initiatorScreenOptions.screenId],s={[e]:{...n,effectStep:"exited"}},i=f({initiatorScreen:o,effectName:"no-effect"});a((e=>({...e,...i,...s}))),c({screenIds:[e,...n.preloadScreens],duration:r[n.effect],preloadedScreenToReset:n.preloaded?n:null})},preloadScreen:({nextScreenOptions:e,initiatorScreenOptions:n})=>{const c=`${e?.screenName||""}_${l()}`,o=n.screenId,s=t[o];return setTimeout((()=>{a((t=>({...t,[o]:{...s,preloadScreens:[...t[o].preloadScreens,c]},[c]:{...e,screenId:c,initiatorScreenOptions:n,effectStep:"expected"}})))}),r[s.effect]),{preloadedScreenId:c,updateProps:e=>{a((n=>({...n,[c]:{...n[c],props:{...n[c].props,...e}}})))}}},screens:t,durationOptions:r}})({durationCustomOptions:r}),[g,k]=n(!1);t((()=>{g&&u({nextScreenOptions:{...a,showBackButton:!1}}),k(!0)}),[g]),s({durationOptions:O,basePageClassName:i});const N=Object.keys(b).map(((n,t)=>e.createElement(o,{key:n,level:t,nextScreen:u,deleteScreens:m,backScreen:S,preloadScreen:x,Screen:b[n],BackButtonComponent:p,BackButtonComponent:()=>e.createElement(e.Fragment,null,"BackB"),basePageClassName:i})));return N};export{p as default};
